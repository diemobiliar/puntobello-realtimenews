{"version":3,"file":"realtimenewsfeed.js","sourceRoot":"","sources":["../../../../src/webparts/realTimeNewsFeed/utils/realtimenewsfeed.ts"],"names":[],"mappings":"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","sourcesContent":["import { Logger, Utility, getRootEnv } from '../utils';\n\n/**\n * Helper function to calculate random delay for distributing SharePoint API load.\n *\n * @param {number} maxDelay - Maximum delay in milliseconds (default: 30000ms = 30 seconds)\n * @returns {number} Random delay between 0 and maxDelay\n */\nfunction getRandomDelay(maxDelay: number = 30000): number {\n  return Math.random() * maxDelay;\n}\n\n/**\n * Processes a socket event by determining its type and validating the associated news item.\n * Based on the event type, it calls the appropriate handler to update the UI or log an error.\n *\n * All event types are processed with a random delay (0-30s) to distribute SharePoint API load\n * and prevent HTTP 503 Service Unavailable errors when many users receive events simultaneously.\n *\n * @param {object} data - The data received from the socket event, where the key represents the event type and the value is the event ID.\n * @param {object} spo - The SharePoint service instance for interacting with the backend.\n * @param {React.MutableRefObject<number>} numberOfNewNewsRef - A ref that keeps track of the number of new news items.\n * @param {Function} setSystemMessageVisible - Function to set the visibility of the system message.\n * @param {React.MutableRefObject<Map<string, NodeJS.Timeout>>} pendingTimeoutsRef - Ref to track pending timeouts for cleanup.\n * @param {Function} processSocketAddEvent - Function to handle the addition of a new news item.\n * @param {Function} processSocketErrorEvent - Function to handle errors from the socket event.\n * @param {Function} updateNews - Function to reload the news from the list.\n *\n * @returns {void}\n */\nexport function processSocketEvent(data: any, spo: any, numberOfNewNewsRef: any, setSystemMessageVisible: any, pendingTimeoutsRef: any, processSocketAddEvent: any, processSocketErrorEvent: any, updateNews: any) {\n  if (spo.filterQuery4Socket === undefined || spo.filterQuery4Socket.length == 0) {\n    return;\n  }\n  // Extract the event type and ID from the data object\n  // The event id is the id of the list item in the news list\n  const eventType = Object.keys(data)[0];\n  const eventId = Number(Object.keys(data).map(k => data[k])[0]);\n\n  // Apply random delay to distribute SharePoint API load (prevent 503 errors)\n  const delay = getRandomDelay();\n  const timeoutKey = `${eventType}_${eventId}`;\n\n  const timeout = setTimeout(async () => {\n    try {\n      // Check if the news item is valid / existing\n      const validItem = await spo.checkValidNewsItem(eventId);\n      if (validItem) {\n        switch (eventType) {\n          case 'A':\n            processSocketAddEvent(numberOfNewNewsRef, setSystemMessageVisible);\n            break;\n          case 'U':\n            processSocketUpdateEvent(updateNews);\n            break;\n          default:\n            processSocketErrorEvent(eventId);\n            break;\n        }\n      }\n    } catch (error) {\n      Logger.getInstance().error('RealTimeNewsFeed, processSocketEvent', error);\n    }\n    // Clean up timeout from map after execution\n    pendingTimeoutsRef.current.delete(timeoutKey);\n  }, delay);\n\n  // Track timeout for cleanup\n  pendingTimeoutsRef.current.set(timeoutKey, timeout);\n}\n\n/**\n* Handles the addition of a new news item by updating the count of new news items\n* and setting the system message to be visible.\n*\n* @param {React.MutableRefObject<number>} numberOfNewNewsRef - A ref that keeps track of the number of new news items.\n* @param {Function} setSystemMessageVisible - Function to set the visibility of the system message.\n*/\nexport function processSocketAddEvent(numberOfNewNewsRef: any, setSystemMessageVisible: any) {\n  setSystemMessageVisible(false);\n  // Increase the number of new news items which are not yet displayed and shown in the system message\n  numberOfNewNewsRef.current++;\n  setSystemMessageVisible(true);\n}\n\n/**\n * Handles the update of a news item by triggering an update of the news feed.\n * Note: Random delay is already applied in processSocketEvent to distribute load.\n *\n * @param {Function} updateNews - Function that triggers the update of the news feed.\n */\nfunction processSocketUpdateEvent(updateNews: any) {\n  updateNews();\n}\n\n/**\n* Logs an error when an undefined event type is received from the socket.\n*\n* @param {number} eventId - The ID of the event that triggered the error.\n*/\nexport function processSocketErrorEvent(eventId: any) {\n  Logger.getInstance().error(\"Undefined event-type has been received from socket webapp\", eventId);\n}\n\n/**\n* Fetches all necessary data for the news feed, including channels, subscriptions, and news items.\n* Updates various refs and sets the loading state accordingly.\n*\n* @param {object} spo - The SharePoint service instance for interacting with the backend.\n* @param {React.MutableRefObject<string>} newsChannelCurrentRef - Ref holding the current news channel GUID.\n* @param {React.MutableRefObject<string>} myNewsGuidRef - Ref holding the GUID of the user's news channel.\n* @param {React.MutableRefObject<Array>} newsChannelsRef - Ref holding the array of news channels.\n* @param {object} pageLanguage - The language representation object for the current page.\n* @param {number} newsCount - The number of news items to fetch.\n* @param {Function} setLoading - Function to set the loading state.\n* @param {React.MutableRefObject<Array>} newsItemsRef - Ref holding the array of news items.\n* @param {React.MutableRefObject<boolean>} stickyRef - Ref indicating whether there is a sticky news item.\n* @param {React.MutableRefObject<number>} channelsubItemIdRef - Ref holding the item ID of the channel subscription.\n*\n* @returns {Promise<void>}\n*/\nexport async function getAllData(spo: any, newsChannelCurrentRef: any, myNewsGuidRef: any, newsChannelsRef: any, pageLanguage: any, newsCount: any, setLoading: any, newsItemsRef: any, stickyRef: any, channelsubItemIdRef: any) {\n  setLoading(true);\n  try {\n    await getChannelsAndSubscriptions(spo, myNewsGuidRef, newsChannelsRef, pageLanguage, channelsubItemIdRef);\n    const responsenews = await spo.getNewsItems(newsChannelCurrentRef.current, myNewsGuidRef.current, newsChannelsRef.current, pageLanguage, newsCount);\n    newsItemsRef.current = responsenews.newsItemData;\n    stickyRef.current = responsenews.sticky;\n  } catch (error) {\n    Logger.getInstance().error('RealTimeNewsFeed.tsx, getAllData', error);\n    newsItemsRef.current = [];\n  }\n  setLoading(false);\n}\n\n/**\n* Retrieves all channels and subscriptions for the current user, then updates the relevant refs with this data.\n*\n* @param {object} spo - The SharePoint service instance for interacting with the backend.\n* @param {React.MutableRefObject<string>} myNewsGuidRef - Ref holding the GUID of the user's news channel.\n* @param {React.MutableRefObject<Array>} newsChannelsRef - Ref holding the array of news channels.\n* @param {object} pageLanguage - The language representation object for the current page.\n* @param {React.MutableRefObject<number>} channelsubItemIdRef - Ref holding the item ID of the channel subscription.\n*\n* @returns {Promise<void>}\n*/\nexport async function getChannelsAndSubscriptions(spo: any, myNewsGuidRef: any, newsChannelsRef: any, pageLanguage: any, channelsubItemIdRef: any) {\n  const currNewsChannels: any[] = [];\n  const newsChannelConfig: any[] = [];\n  const allCachedChannels = await spo.getAndCacheAllChannels();\n  const channels2subItem = await spo.getSubscribedChannels4CurrentUser();\n\n  if (channels2subItem.length > 0) {\n    channels2subItem[0].pb_Channels.forEach((channel: any) => {\n      const newChan = { Channel: [], TermGuid: channel.TermGuid, Subscribed: true, Visible: true, SortOrder: 0 };\n      newsChannelConfig.push(newChan);\n    });\n    // Set the id of the channel subscription item for the current user\n    channelsubItemIdRef.current = channels2subItem[0].Id;\n  } else {\n    // The user has no subscriptions yet, so we create a new subscription item\n    const newSubItem = await spo.addSubscribedChannels4CurrentUser();\n    // and save this id in the ref\n    channelsubItemIdRef.current = newSubItem.ID;\n  }\n\n  // The myNews channel is always available and visible, it shows all news for the channels subscribed by the user\n  currNewsChannels.push({\n    Channel: [{ Language: pageLanguage.Language, Text: Utility.getStringTranslation4Locale('myNewsLabel', pageLanguage.Language) }],\n    TermGuid: myNewsGuidRef.current, Subscribed: false, Visible: true, SortOrder: 0\n  });\n\n  allCachedChannels.forEach((channel: any) => {\n    if (!channel.isDeprecated) {\n      const channelLanguages = channel.labels.map((label: any) => ({ Language: label.languageTag, Text: label.name }));\n      const currentNewsChannel = newsChannelConfig.find(newsChannel => newsChannel.TermGuid === channel.id);\n      if (currentNewsChannel || newsChannelConfig.length == 0) {\n        currNewsChannels.push({ Channel: channelLanguages, TermGuid: channel.id, Subscribed: true, Visible: true, SortOrder: 0 });\n      } else {\n        currNewsChannels.push({ Channel: channelLanguages, TermGuid: channel.id, Subscribed: false, Visible: true, SortOrder: 0 });\n      }\n    }\n  });\n  // Update the ref with all available channels\n  newsChannelsRef.current = currNewsChannels;\n}\n\n/**\n* Updates the channel settings based on user interaction with the channel subscription interface.\n* It modifies the current state of channels (subscribed/unsubscribed) and updates this information in SharePoint.\n*\n* @param {object} spo - The SharePoint service instance for interacting with the backend.\n* @param {React.MutableRefObject<Array>} newsChannelsRef - Ref holding the array of news channels.\n* @param {object} item - The news channel item being modified.\n* @param {boolean} isChecked - Whether the channel is now checked (subscribed) or unchecked (unsubscribed).\n* @param {React.MutableRefObject<number>} channelsubItemIdRef - Ref holding the item ID of the channel subscription.\n*/\nexport function changeChannelSettings(spo: any, newsChannelsRef: any, item: any, isChecked: any, channelsubItemIdRef: any) {\n  const channels: any[] = [];\n  // Recreate the channel settings based on the user's interaction\n  if (isChecked) {\n    newsChannelsRef.current.forEach((channel: any) => {\n      if (channel.Subscribed) {\n        channels.push({ termName: channel.Channel[0].Text, termGUID: channel.TermGuid });\n      } else {\n        if (channel.TermGuid === item.TermGuid) {\n          channel.Subscribed = true;\n          channels.push({ termName: channel.Channel[0].Text, termGUID: channel.TermGuid });\n        }\n      }\n    });\n  } else {\n    newsChannelsRef.current.forEach((channel: any) => {\n      if (channel.Subscribed) {\n        if (channel.TermGuid != item.TermGuid) {\n          channels.push({ termName: channel.Channel[0].Text, termGUID: channel.TermGuid });\n        } else {\n          channel.Subscribed = false;\n        }\n      }\n    });\n  }\n  // Update the channel settings for the current user\n  spo.updateMultiMeta(channels, getRootEnv().config.spfxSubscribedChannelsListTitle, 'pb_Channels', channelsubItemIdRef.current).then().catch((error: any) => {\n    Logger.getInstance().error('CHANGE_CHANNEL_SETTINGS', error);\n  });\n}\n\n/**\n* Fetches available news items based on the current channel selection and updates the component's state.\n*\n* @param {object} spo - The SharePoint service instance for interacting with the backend.\n* @param {React.MutableRefObject<string>} newsChannelCurrentRef - Ref holding the current news channel GUID.\n* @param {React.MutableRefObject<string>} myNewsGuidRef - Ref holding the GUID of the user's news channel.\n* @param {React.MutableRefObject<Array>} newsChannelsRef - Ref holding the array of news channels.\n* @param {object} pageLanguage - The language representation object for the current page.\n* @param {number} newsCount - The number of news items to fetch.\n* @param {React.MutableRefObject<Array>} newsItemsRef - Ref holding the array of news items.\n* @param {React.MutableRefObject<boolean>} stickyRef - Ref indicating whether there is a sticky news item.\n* @param {Function} setLoading - Function to set the loading state.\n* @param {object} logger - Logger instance for logging information and errors.\n*\n* @returns {Promise<void>}\n*/\nexport async function getAvailableItems(spo: any, newsChannelCurrentRef: any, myNewsGuidRef: any, newsChannelsRef: any, pageLanguage: any, newsCount: any, newsItemsRef: any, stickyRef: any, setLoading: any, logger: any) {\n  setLoading(true);\n  try {\n    const responsenews = await spo.getNewsItems(newsChannelCurrentRef.current, myNewsGuidRef.current, newsChannelsRef.current, pageLanguage, newsCount);\n    newsItemsRef.current = responsenews.newsItemData;\n    stickyRef.current = responsenews.sticky;\n  } catch (error) {\n    logger.getInstance().error('GET_NEWS_GENERIC', error);\n    newsItemsRef.current = [];\n  }\n  setLoading(false);\n}\n\n/**\n* Generates the dropdown options for selecting a news channel, based on the user's current subscriptions.\n*\n* @param {React.MutableRefObject<Array>} newsChannelsRef - Ref holding the array of news channels.\n* @param {React.MutableRefObject<string>} myNewsGuidRef - Ref holding the GUID of the user's news channel.\n* @param {object} pageLanguage - The language representation object for the current page.\n*\n* @returns {Array} An array of dropdown options for selecting a news channel.\n*/\nexport function getChannelDD(newsChannelsRef: any, myNewsGuidRef: any, pageLanguage: any) {\n  const retVal: any[] = [];\n  const currNewsChannels = newsChannelsRef.current;\n  currNewsChannels.map((newschannel: any) => {\n    if (newschannel.TermGuid == myNewsGuidRef.current || newschannel.Subscribed) {\n      retVal.push({ key: newschannel.TermGuid, text: Utility.getChannelText(pageLanguage, newschannel) });\n    }\n  });\n  return retVal;\n}\n\n"]}